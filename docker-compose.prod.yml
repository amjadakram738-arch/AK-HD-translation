# docker-compose.prod.yml

## ๐ฏ ุงูุบุฑุถ ูุงููุฏู
ููู ุชูููู Docker Compose ูุจูุฆุฉ ุงูุฅูุชุงุฌุ ูุฑูุฒ ุนูู ุงูุฃุฏุงุกุ ุงูุฃูุงูุ ููุงุจููุฉ ุงูุชูุณุน.

## ๐ ุงูุฎุฏูุงุช ุงููุถููุฉ
1.  **db:** ูุงุนุฏุฉ ุจูุงูุงุช TiDB/MySQL (ูุน ุชูููู ุฅูุชุงุฌ).
2.  **backend:** ุงูุฎุงุฏู ุงูุฎููู (ุตูุฑุฉ ูุจููุฉ ูุณุจููุง).
3.  **frontend:** ูุงุฌูุฉ ุงููุณุชุฎุฏู (ุตูุฑุฉ ูุจููุฉ ูุณุจููุง).
4.  **nginx:** ุฎุงุฏู ูููู ุนูุณู (Reverse Proxy) ูุชูุฏูู ุงููุญุชูู ุงูุซุงุจุช ูุชูุฌูู ุงูุทูุจุงุช.

```yaml
version: '3.8'

services:
  # 1. ูุงุนุฏุฉ ุงูุจูุงูุงุช (ููุชุฑุถ ุงุณุชุฎุฏุงู ุฎุฏูุฉ ุณุญุงุจูุฉ ููุฏุงุฑุฉ ูู ุงูุฅูุชุงุฌ ุงููุนูู)
  db:
    image: mysql:8.0
    container_name: stt_translator_db_prod
    environment:
      # ูุฌุจ ุงุณุชุฎุฏุงู ูุฎุฒู ุฃุณุฑุงุฑ ูุชุญููู ูุฐู ุงููุชุบูุฑุงุช
      MYSQL_ROOT_PASSWORD: ${DB_PASSWORD}
      MYSQL_DATABASE: ${DB_NAME}
    volumes:
      - db_data_prod:/var/lib/mysql
    restart: always
    # ูููุฏ ุงูููุงุฑุฏ
    deploy:
      resources:
        limits:
          cpus: '0.50'
          memory: 1024M

  # 2. ุงูุฎุงุฏู ุงูุฎููู
  backend:
    # ูุฌุจ ุงุณุชุฎุฏุงู ุตูุฑุฉ ูุจููุฉ ูุณุจููุง ูู CI/CD
    image: stt-translator/backend:latest
    container_name: stt_translator_backend_prod
    depends_on:
      - db
    environment:
      NODE_ENV: production
      PORT: 3000
      DB_HOST: db
      # ูุฌุจ ุชุญููู ุงูุฃุณุฑุงุฑ ูู ูุฎุฒู ุฃุณุฑุงุฑ
      GOOGLE_API_KEY: ${GOOGLE_API_KEY}
    restart: always
    deploy:
      replicas: 3 # ุชุดุบูู 3 ูุณุฎ ูุชุญููู ุงูุชูุงูุฑูุฉ ุงูุนุงููุฉ
      resources:
        limits:
          cpus: '0.25'
          memory: 512M

  # 3. ูุงุฌูุฉ ุงููุณุชุฎุฏู (ูุชู ุชูุฏูููุง ุนุจุฑ Nginx)
  frontend:
    # ูุฌุจ ุงุณุชุฎุฏุงู ุตูุฑุฉ ูุจููุฉ ูุณุจููุง ูู CI/CD
    image: stt-translator/frontend:latest
    container_name: stt_translator_frontend_prod
    restart: always
    deploy:
      resources:
        limits:
          cpus: '0.10'
          memory: 256M

  # 4. ุฎุงุฏู ูููู ุนูุณู (Reverse Proxy)
  nginx:
    image: nginx:stable-alpine
    container_name: stt_translator_nginx_prod
    depends_on:
      - backend
      - frontend
    ports:
      - "80:80"
      - "443:443" # ูุชูููู HTTPS
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./frontend/build:/usr/share/nginx/html:ro # ุชูุฏูู ุงููููุงุช ุงูุซุงุจุชุฉ
    restart: always

volumes:
  db_data_prod:
```
---
**ููุงุญุธุงุช ุงูุฌูุฏุฉ:**
- [ ] ุชู ุงูุชุญูู ูู ุงููููู
- [ ] ุชู ุงูุชุญูู ูู ุงูุฑูุงุจุท
- [ ] ุชู ูุฑุงุฌุนุฉ ุงููุญุชูู
- [ ] ุชู ุชุญููู ุงูุชุฑุงุจุท
