# SecurityBoundary.md - حدود الأمان ومعمارية الوكيل (Proxy Architecture)

## الهدف
تحديد حدود الأمان الصارمة للمشروع، مع التركيز على حماية مفاتيح API الحساسة وضمان عدم كشفها في بيئة العميل (Chrome Extension).

## النطاق الوظيفي
1.  **منع الكشف:** منع أي مفتاح API سحابي (Google STT, DeepL, إلخ) من الوجود أو فك التشفير في ذاكرة المتصفح.
2.  **التوجيه الآمن:** توجيه جميع الطلبات الحساسة (STT و Translation) عبر خادم وسيط (Proxy Server) آمن.
3.  **المصادقة:** استخدام نظام مصادقة قائم على الرمز المميز (Token-based Authentication) بين الإضافة والخادم الوسيط.

## المسؤوليات
| المسؤولية | الموقع | الوصف |
| :--- | :--- | :--- |
| **تخزين المفاتيح** | الخادم الوسيط (Proxy Server) | تخزين مفاتيح API السحابية الحقيقية في بيئة آمنة (مثل HashiCorp Vault أو AWS Secrets Manager). |
| **الوكيل الآمن** | الخادم الوسيط (Proxy Server) | استقبال الطلبات من الإضافة، إضافة مفتاح API السحابي، وإرسال الطلب إلى الخدمة السحابية، ثم إعادة توجيه النتيجة. |
| **العميل الوكيل** | `Background.js` | إرسال جميع طلبات STT والترجمة إلى نقطة نهاية الخادم الوسيط بدلاً من نقاط نهاية الخدمات السحابية الأصلية. |
| **المصادقة** | الخادم الوسيط و `Background.js` | التحقق من صحة الرمز المميز (Token) المرسل من الإضافة قبل معالجة الطلب. |

## ما لا يقع ضمن مسؤوليته
*   أمان المتصفح الأساسي (مسؤولية Chrome).
*   أمان الخادم الوسيط نفسه (مسؤولية البنية التحتية للخادم).

## القيود التقنية والحلول المقترحة
| القيد التقني | الحل المقترح (التخفيف) |
| :--- | :--- |
| **كشف مفاتيح API في العميل** | **الحل:** تطبيق نمط الوكيل (Proxy Pattern) بشكل صارم. يجب أن يكون `Background.js` على علم فقط بعنوان URL للخادم الوسيط والرمز المميز للمصادقة، وليس مفاتيح API السحابية. |
| **تكلفة الخادم الوسيط** | **الحل:** استخدام بنية تحتية خالية من الخادم (Serverless) مثل AWS Lambda أو Google Cloud Functions للخادم الوسيط، مما يقلل من التكاليف التشغيلية ويسمح بالتوسع التلقائي. |
| **المصادقة بين الإضافة والوكيل** | **الحل:** استخدام رمز مميز قصير الأجل (Short-lived Token) يتم تجديده بشكل دوري، ويتم تخزينه في `chrome.storage.local` (أكثر أماناً من الذاكرة المؤقتة). |
