# جدول التصحيحات النصية والمخاطر المتبقية

## 1. جدول التصحيحات النصية

| الملف المتأثر | النص الحالي (كما هو) | النص البديل المقترح | سبب التعديل التقني |
| :--- | :--- | :--- | :--- |
| **المرحلة-2-التصميم-المعماري.md** (في أي مكان يشير إلى Batch Processing أو FFmpeg) | "يتم تصميم الهيكل لضمان تحقيق المتطلبات غير الوظيفية (NFRs)، خاصة الأداء (NFR1.0) وقابلية التوسع (NFR4.0)، من خلال الفصل الواضح بين المسؤوليات (SRP) واستخدام نمط Microservices Architecture للوحدات المستقلة. كما يدعم النظام معالجة الفيديو غير المتزامنة باستخدام FFmpeg." | "يتم تصميم الهيكل لضمان تحقيق المتطلبات غير الوظيفية (NFRs)، خاصة الأداء (NFR1.0) وزمن الاستجابة المنخفض (NFR4.0)، من خلال الفصل الواضح بين المسؤوليات (SRP) واستخدام نمط Modular Architecture للوحدات المستقلة. **النظام مصمم حصرياً للترجمة الفورية داخل المتصفح ولا يدعم معالجة الفيديو غير الفورية.**" | تثبيت الرؤية المعمارية على "إضافة Chrome للترجمة الفورية فقط" وإلغاء أي إشارة إلى Batch Processing أو FFmpeg. |
| **المرحلة-5-نظام-التعرف-على-الكلام.md** (في واجهة `ISTTEngine`) | `process(audioSegment: AudioSegment): Promise<STTResult>;` | `startStream(stream: MediaStream): Promise<void>;` <br> `stopStream(): Promise<void>;` <br> `on(event: 'result', listener: (result: STTResult) => void): void;` | تصحيح نظام STT من نموذج الطلب/الاستجابة (Request/Response) إلى نموذج التدفق المستمر (Streaming) لتقليل زمن الاستجابة وتحقيق متطلب "الوقت الفعلي". |
| **المرحلة-5-نظام-التعرف-على-الكلام.md** (في محول Google/Azure STT) | `const apiKey = await SecurityManager.decrypt(encryptedApiKey);` | **يتم حذف هذا السطر بالكامل.** <br> **النص البديل في الوصف:** "يتم استبدال عملية فك التشفير المحلية باستدعاء نقطة نهاية آمنة على الخادم الوسيط (Proxy Server) الذي يقوم بإضافة مفتاح API السحابي وإرسال الطلب نيابة عن الإضافة. لا يتم فك تشفير المفتاح داخل بيئة العميل." | تصحيح الأمن ومنع فك تشفير مفاتيح API الحساسة داخل بيئة العميل (Service Worker) لضمان عدم تسريبها. |
| **المرحلة-2-التصميم-المعماري.md** (في واجهة `AudioAPI`) | `processAudio(segment: AudioSegment): Promise<STTResult>` | **يتم حذف هذه الوظيفة بالكامل.** | تم نقل مسؤولية معالجة الصوت إلى `STT Streaming Adapter` لتوحيد مفهوم التدفق. |
| **المرحلة-2-التصميم-المعماري.md** (في واجهة `AudioAPI`) | `startCapture(source: CaptureSource): Promise<void>` | `startCapture(tabId: number): Promise<MediaStream>;` | توثيق آلية التقاط الصوت المعتمدة بوضوح (باستخدام `tabId` الذي يشير إلى `chrome.tabCapture` API). |

## 2. الملفات التي تم إلغاؤها

تم إلغاء جميع الملفات التي تتعارض مع الرؤية المعمارية الجديدة (إضافة Chrome للترجمة الفورية فقط) والتي تشير إلى معالجة الفيديو غير الفورية أو Batch Processing أو FFmpeg.

| اسم الملف | سبب الإلغاء |
| :--- | :--- |
| `المرحلة-13 + المرحلة-14-(التكامل-المتقدم-مع-الفيديو)+(التوثيق-والتسليم-النهائي).md` | يحتوي على متطلبات Batch Processing و FFmpeg التي تم إلغاؤها. |
| `المرحلة-14-التكامل-المتقدم-مع-الفيديو.md` (إن وجد) | يحتوي على متطلبات Batch Processing و FFmpeg التي تم إلغاؤها. |
| أي ملف يشير إلى `FFmpeg` أو `S3` أو `Kafka` في سياق معالجة الفيديو. | إلغاء المكونات غير المتوافقة مع الترجمة الفورية داخل المتصفح. |

## 3. الملفات الجديدة مع محتواها الكامل

تم إضافة الملفات التالية لسد الثغرات الحرجة في الخطة:

| اسم الملف | الغرض التقني | حالة الإرفاق |
| :--- | :--- | :--- |
| **`05-آلية-التقاط-الصوت-في-المتصفح.md`** | توثيق الآلية التقنية المعتمدة لالتقاط الصوت (`chrome.tabCapture`). | **مرفق** |
| **`06-نظام-التدفق-المستمر-لـ-STT.md`** | توثيق مفهوم التدفق المستمر (Streaming) لـ STT. | **مرفق** |
| **`07-معمارية-الأمان-للمفاتيح-السحابية.md`** | توثيق نمط الوكيل (Proxy Pattern) لمنع تسريب مفاتيح API. | **مرفق** |

## 4. ملاحظات المخاطر المتبقية

على الرغم من التصحيحات، لا تزال هناك مخاطر هندسية وتنظيمية متبقية يجب أخذها في الاعتبار:

| الخطر المتبقي | الوصف التفصيلي |
| :--- | :--- |
| **قيود `chrome.tabCapture`** | على الرغم من اعتماد `chrome.tabCapture`، فإن هذا API يتطلب تفاعلاً من المستخدم (اختيار التبويب) وله قيود على التبويبات التي يمكنه التقاطها (مثل التبويبات المحمية). هذا قد يؤدي إلى تجربة مستخدم غير سلسة أو فشل في الالتقاط في بعض السيناريوهات. |
| **تكلفة الخادم الوسيط (Proxy)** | اعتماد نمط الوكيل (Proxy Pattern) لحل مشكلة الأمان يعني أن المشروع يحتاج الآن إلى بنية تحتية للخادم (Backend) لإدارة المفاتيح وتمرير الطلبات. هذا يضيف تعقيدًا وتكلفة تشغيلية لم تكن موجودة في التصميم الأصلي (الذي كان يعتمد على العميل فقط). |
| **زمن الاستجابة للترجمة (Translation Latency)** | تم حل مشكلة زمن الاستجابة لـ STT (عبر Streaming)، ولكن زمن استجابة محركات الترجمة السحابية (Translation Engines) لا يزال يمثل عنق زجاجة محتملاً. يجب أن تتضمن المرحلة 4 آليات قوية للتخزين المؤقت (Cache) والتحميل المسبق (Pre-fetching) لتقليل هذا التأخير. |
